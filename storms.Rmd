---
title: "Analyzing Storm Data"
author: "Egor Ignatenkov"
date: "Thursday, September 18, 2014"
output: html_document
---

###Synopsys

###Data processing

First, let's get our file and read some data.

```{r download, cache=TRUE}
download.file("http://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2", "stormdata.bz2")
data_header<-read.csv("stormdata.bz2", header = FALSE, nrow = 1)
take<-c("BGN_DATE", "BGN_TIME", "STATE", "EVTYPE", "FATALITIES", "INJURIES", "PROPDMG", "CROPDMG")
takecols <- ifelse(t(data_header) %in% take, NA, 'NULL')
data<-read.csv("stormdata.bz2", colClasses=takecols)
```

We will have to look to the "EVTYPE" column. The data in that column is not very neat: there are some entries that differ only by uppercase/lowercase (WIND/Wind) or plural/singular form (WILDFIRE/WILDFIRES), so we'll have to do some cleaning. 

```{r cleaning}
data$EVTYPE<-gsub('(?i).*WIND.*', 'THUNDERSTORM WIND', data$EVTYPE)
data$EVTYPE<-gsub('(?i).*FLOOD.*', 'FLOOD', data$EVTYPE)
data$EVTYPE<-gsub('(?i).*FLD.*', 'FLOOD', data$EVTYPE)
data$EVTYPE<-gsub('(?i).*FIRE.*', 'WILDFIRE', data$EVTYPE)
data$EVTYPE<-gsub('(?i).*HAIL.*', 'HAIL', data$EVTYPE)
data$EVTYPE<-gsub('(?i).*HEAT.*', 'HEAT', data$EVTYPE)
data$EVTYPE<-gsub('(?i).*HURRICANE.*', 'HURRICANE', data$EVTYPE)
data$EVTYPE<-gsub('(?i).*FOG.*', 'FOG', data$EVTYPE)
data$EVTYPE<-gsub('(?i).*WINTER STORM.*', 'ICE STORM', data$EVTYPE)
data$EVTYPE<-gsub('(?i).*BLIZZARD.*', 'ICE STORM', data$EVTYPE)
data$EVTYPE<-gsub('(?i).*WINTER WEATHER.*', 'EXTREME COLD', data$EVTYPE)
data$EVTYPE<-gsub('(?i).*FROST.*', 'EXTREME COLD', data$EVTYPE)
data$EVTYPE<-gsub('(?i).*FREEZE.*', 'EXTREME COLD', data$EVTYPE)
data$EVTYPE<-gsub('(?i).*COLD.*', 'EXTREME COLD', data$EVTYPE)
data$EVTYPE<-gsub('(?i).*CURRENT.*', 'RIP CURRENTS', data$EVTYPE)
data$EVTYPE<-gsub('(?i).*RAIN.*', 'HEAVY RAIN', data$EVTYPE)
data$EVTYPE<-gsub('(?i).*SNOW.*', 'HEAVY SNOW', data$EVTYPE)
data$EVTYPE<-gsub('(?i).*TROPICAL STORM.*', 'TROPICAL STORM', data$EVTYPE)
data$EVTYPE<-gsub('(?i).*STORM SURGE.*', 'STORM SURGE', data$EVTYPE)
```


###Results

####Across the United States, which types of events are most harmful with respect to population health?


```{r}
pop_health<-aggregate(INJURIES ~ EVTYPE, data = data, sum)
```

Let's look on what's on top.

```{r}
head(pop_health[order(-pop_health$INJURIES),],20)
```

It's clear now that it's no point in dealing with typos and singular/plural forms anymore, since the results are quite obvious.

####Across the United States, which types of events have the greatest economic consequences?

First, let's check property damage:

```{r}
prop_damage<-aggregate(PROPDMG ~ EVTYPE, data = data, sum)
```

Let's look on what's on top.

```{r}
head(prop_damage[order(-prop_damage$PROPDMG),],20)
```

Now let's look at crop damage:

```{r}
crop_damage<-aggregate(CROPDMG ~ EVTYPE, data = data, sum)
```

Let's look on what's on top.

```{r}
head(crop_damage[order(-crop_damage$CROPDMG),],20)
```